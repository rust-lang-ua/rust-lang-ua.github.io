## Спростовуваність: Чи Може Шаблон Бути Невідповідним

Шаблони бувають двох видів: спростовні та неспростовні. Шаблони, які збігаються з будь-яким можливим переданим значенням, є *неспростовними*. Прикладом може бути `x` в інструкції `let x = 5;` тому що `x` збігається з будь-яким значенням і тому не може не збігатися. Шаблони, які можуть не збігатися з деякими можливими значеннями, є *спростовними*. Прикладом може бути `Some(x)` у виразі `if let Some(x) = a_value`, тому що якщо значення змінної `a_value` буде `None`, а не `Some`, то шаблон `Some(x)` не буде зіставлятися.

Параметри функцій, інструкції `let` і цикли `for` можуть приймати тільки неспростовні шаблони, тому що програма не може зробити нічого путнього, коли значення не збігаються. Вирази `if let` і `while let` допускають спростовні і неспростовні шаблони, але компілятор застерігає від неспростовних шаблонів, оскільки за визначенням вони призначені для обробки можливих збоїв: функціональність умови полягає в її здатності працювати по-різному в залежності від успіху або невдачі.

В цілому, ви не повинні турбуватися про різницю між спростовуваними і не спростовуваними шаблонами; однак, ви повинні бути знайомі з концепцією спростовуваності, щоб мати можливість реагувати, коли ви бачите її в повідомленні про помилку. У таких випадках вам потрібно буде змінити або шаблон, або конструкцію, в якій ви використовуєте шаблон, в залежності від бажаної поведінки коду.

Розгляньмо приклад того, що відбувається, коли ми намагаємося використати спростовуваний шаблон там, де Rust вимагає неспростовний шаблон і навпаки. У Блоці Коду 18-8 показано інструкцію `let`, але для шаблону ми вказали `Some(x)`, спростовуваний шаблон. Як і слід було очікувати, цей код не буде компілюватися.

```rust,ignore,does_not_compile
{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-08/src/main.rs:here}}
```


<span class="caption">Listing 18-8: Attempting to use a refutable pattern with `let`</span>

Якщо значення `some_option_value` було б значенням `None`, то воно не відповідало б шаблону `Some(x)`, що означає, що шаблон є спростовуваним. Однак, інструкція `let` може приймати тільки неспростовний шаблон, тому що код не може зробити нічого коректного зі значенням `None`. Під час компіляції Rust поскаржиться, що ми намагалися використати спростовуваний шаблон там, де потрібен неспростовний шаблон:

```console
{{#include ../listings/ch18-patterns-and-matching/listing-18-08/output.txt}}
```

Оскільки ми не покрили (і не могли покрити!) кожне допустиме значення шаблоном `Some(x)`, Rust справедливо видасть помилку компілятора.

Якщо у нас є спростовний шаблон там, де потрібен неспростовний, ми можемо виправити це, змінивши код, який використовує шаблон: замість використання `let`,, ми можемо використати `if let`. Тоді, якщо шаблон не збігається, код просто пропустить код у фігурних дужках, даючи йому можливість продовжити правильне виконання коду. У Блоці Коду 18-9 показано, як виправити код у Блоці Коду 18-8.

```rust
{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-09/src/main.rs:here}}
```


<span class="caption">Listing 18-9: Using `if let` and a block with refutable patterns instead of `let`</span>

Ми дали коду вихід! Цей код абсолютно дійсний, хоча це означає, що ми не можемо використовувати неспростовний шаблон без отримання помилки. Якщо ми дамо `if let` шаблон, який завжди збігатиметься, наприклад, `x`, як показано у Блоці Коду 18-10, компілятор видасть попередження.

```rust
{{#rustdoc_include ../listings/ch18-patterns-and-matching/listing-18-10/src/main.rs:here}}
```


<span class="caption">Listing 18-10: Attempting to use an irrefutable pattern with `if let`</span>

Rust скаржиться, що немає сенсу використовувати `if let` з неспростовним шаблоном:

```console
{{#include ../listings/ch18-patterns-and-matching/listing-18-10/output.txt}}
```

З цієї причини рукави збігів повинні використовувати спростовувані шаблони, за винятком останнього плеча, яке повинно збігатися з будь-якими значеннями, що залишилися, з неспростовним шаблоном. Rust дозволяє використовувати неспростовний шаблон у `match` лише з одним рукавом, але цей синтаксис не є особливо корисним і може бути замінений простішим оператором `let`.

Тепер, коли ви знаєте, де використовувати шаблони і в чому різниця між спростовуваними і не спростовуваними шаблонами, розгляньмо весь синтаксис, який можна використовувати для створення шаблонів.
